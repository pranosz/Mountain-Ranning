/*! mountain-running - v1.0.0 - 2018-03-20 */
var mrApp=angular.module("mountainRunning",["ngRoute","mrServices","moment-picker","pagingModule","customFilters"]);mrApp.config(["$routeProvider","$locationProvider","momentPickerProvider",function($routeProvider,$locationProvider,momentPickerProvider){momentPickerProvider.options({format:"L LTS",minView:"decade",maxView:"day",startView:"day",autoclose:!0,today:!1,keyboard:!1,leftArrow:"&larr;",rightArrow:"&rarr;",yearsFormat:"YYYY",monthsFormat:"MMM",daysFormat:"D"}),$routeProvider.when("/competitions",{templateUrl:"views/competitions.html"}).otherwise({redirectTo:"/competitions"})}]),$(function(){$("#btn-details").click(function(){$("#item-details-1").toggle()})}),mrApp.controller("mainPageCtrl",["$scope","competitions",function($scope,competitions){$scope.selectCountry=["poland","austria","croatia","slovakia"],$scope.selectCategory=["alpejski","anglosaski","dÅ‚ugi","ultra"],$scope.toggle=!1,$scope.showFilters=function(){$scope.toggle=!$scope.toggle},$scope.min={date:moment().locale("en")},$scope.max={date:moment().locale("en").add(12,"month")},$("#country").multiselect({selectAll:!0,minHeight:null,showCheckbox:!0,texts:{placeholder:"Select Country",search:"Search States"}}),$("#category").multiselect({selectAll:!0,minHeight:null,showCheckbox:!0,texts:{placeholder:"Select Category",search:"Search States"}}),$scope.items={},$scope.currentPage=1,$scope.pageSize=5,$scope.filtered=[],$scope.numOfPages=[];var _calculatePages=function(){var temp=[];if($scope.filtered.length>1)for(var i=0;i<Math.ceil($scope.filtered.length/$scope.pageSize);i++)temp.push({name:i+1,num:i+1});return temp};$scope.numOfPages=_calculatePages(),$scope.$watch("items | multiSelectFilter:selectCountry:'country' | filter:{header:cName} | rangeFilter:min:max | multiSelectFilter:selectCategory:'category'",function(newVal){$scope.filtered=newVal,$scope.numOfPages=_calculatePages()},!0),competitions.getCompetitions(function(competitions){$scope.items=competitions.data})}]),angular.module("mrServices",[]).factory("competitions",["$http",function($http){return{getCompetitions:function(callback){callback=callback||function(){},$http.get("/api.php/competitions").then(function(response){callback(response)},function(response){})}}}]),angular.module("pagingModule",[]).directive("paging",[function(){return{restrict:"EA",link:function($scope,$iElement,$iAttrs){$scope.setPage=function(pageNum){$scope.currentPage=pageNum}},template:function(iElement,iAttrs){return'<ul data-ng-class="pagesUlClass"><li data-ng-class="pageLiClass" data-ng-repeat="item in pages"><a data-ng-click="setPage(item.num)" class="pageBtnClass">{{item.name}}</a></li></ul>'},scope:{pages:"=",currentPage:"="}}}]),angular.module("customFilters",[]).filter("rangeFilter",function($log){return function(items,min,max){var filters={price:{minPrice:0,maxPrice:99999},distance:{minDistance:0,maxDistance:99999},altitude:{minAltitude:0,maxAltitude:99999},pointsUTMB:{minPointsUTMB:0,maxPointsUTMB:99999},pointsBUGT:{minPointsBUGT:0,maxPointsBUGT:99999}},filtered=[];angular.forEach(filters,function(obj,name){min[name]&&(obj[Object.keys(obj)[0]]=min[name]),max[name]&&(obj[Object.keys(obj)[1]]=max[name])});var dateMin=new Date(min.date),dateMax=new Date(max.date);return angular.forEach(items,function(item){var dateItem=new Date(item.date);Number(item.distance)<=filters.distance.maxDistance&&Number(item.distance)>=filters.distance.minDistance&&Number(item.priceMin)<=filters.price.maxPrice&&Number(item.priceMin)>=filters.price.minPrice&&Number(item.up)<=filters.altitude.maxAltitude&&Number(item.up)>=filters.altitude.minAltitude&&Number(item.pointsUTMB)<=filters.pointsUTMB.maxPointsUTMB&&Number(item.pointsUTMB)>=filters.pointsUTMB.minPointsUTMB&&Number(item.pointsBUGT)<=filters.pointsBUGT.maxPointsBUGT&&Number(item.pointsBUGT)>=filters.pointsBUGT.minPointsBUGT&&dateItem.getTime()>=dateMin.getTime()&&dateItem.getTime()<=dateMax.getTime()&&filtered.push(item)}),filtered}}).filter("multiSelectFilter",function(){return function(items,arr,propName){if(angular.isDefined(arr)){var filtered=[];return angular.forEach(items,function(item){-1!==arr.indexOf(item[propName].toLowerCase())&&filtered.push(item)}),filtered}}}).filter("paging",function($filter){return function(items,currentPage,pageSize){if(!angular.isArray(items)||currentPage>=pageSize)return items;var startPage=(currentPage-1)*pageSize;return $filter("limitTo")(items.slice(startPage),pageSize)}});